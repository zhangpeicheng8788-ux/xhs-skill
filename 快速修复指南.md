# 小红书批量发布工具 - 快速修复指南

## 🚨 遇到"无登录信息"错误？

如果启动工具后看到以下错误:
```
{'code': -1, 'success': False}
{'code': -100, 'msg': '无登录信息', 'success': False}
```

**不要慌！按照以下3步即可修复：**

---

## ⚡ 3步快速修复

### 步骤1: 重新登录（2分钟）

**双击运行**:
```
fix_cookie_quick.bat
```

或命令行运行:
```bash
python scripts/login_xhs.py
```

**操作**:
1. 浏览器会自动打开小红书登录页面
2. 使用小红书APP扫描二维码
3. 登录成功后Cookie会自动保存

### 步骤2: 启动修复版工具（1秒）

**双击运行**:
```
start_publish_fixed.bat
```

### 步骤3: 开始发布（简单3步）

1. **选择路径**: 点击"浏览"选择 `D:\jieyue_work`
2. **检测笔记**: 点击"检测笔记"查看所有笔记
3. **开始发布**: 点击"开始发布"启动批量发布

---

## 📁 文件说明

### 修复相关文件
- `fix_cookie_quick.bat` - 快速重新登录脚本
- `start_publish_fixed.bat` - 修复版启动脚本
- `scripts/publish_gui_v3_fixed.py` - 修复版发布工具

### 原始文件（保留）
- `start_publish.bat` - 原始启动脚本
- `scripts/publish_gui_v3.py` - 原始发布工具

---

## 🎯 功能特性

### ✅ 已修复的问题
1. **Cookie验证失败** - 现在会友好提示并引导重新登录
2. **错误提示不明确** - 现在提供清晰的中文错误说明
3. **缺少解决方案** - 现在提供详细的修复步骤

### ✅ 核心功能
1. **递归遍历** - 自动检测所有子目录中的笔记
2. **智能去重** - 自动跳过已发布的笔记
3. **发布记录** - 记录所有发布历史
4. **实时日志** - 显示详细的发布进度

---

## 📊 使用示例

### 示例1: 发布单个目录
```
D:\jieyue_work\
├── note_1\
│   ├── cover.png
│   ├── card_1.png
│   └── card_2.png
└── note_2\
    ├── cover.png
    └── card_1.png
```

**操作**: 选择 `D:\jieyue_work`，工具会自动检测到2个笔记

### 示例2: 发布多层目录
```
D:\jieyue_work\
├── note_1\
│   └── cover.png
└── drivingschool_notes\
    ├── note_01\
    │   └── cover.png
    └── note_02\
        └── cover.png
```

**操作**: 选择 `D:\jieyue_work`，工具会递归检测到3个笔记

---

## ⚙️ 配置说明

### 发布间隔
- **推荐**: 20分钟（避免被限流）
- **最小**: 5分钟
- **最大**: 120分钟

### 起始笔记
- 从第几个笔记开始发布
- 默认: 1（从第一个开始）

---

## 🔍 常见问题

### Q: 为什么需要重新登录？
A: 小红书的Cookie有时效性，通常7-30天过期，过期后需要重新登录。

### Q: 登录后Cookie保存在哪里？
A: 保存在 `.env` 文件中，位于项目根目录。

### Q: 如何查看已发布的笔记？
A: 点击GUI中的"发布记录"按钮，或查看 `publish_records.json` 文件。

### Q: 如何重新发布某个笔记？
A: 删除笔记目录中的 `.published` 文件即可。

### Q: 工具会重复发布吗？
A: 不会，工具会自动跳过已发布的笔记。

---

## 📞 需要帮助？

### 诊断工具
```bash
# 测试Cookie是否有效
python test_cookie_loading.py

# 查看详细日志
# 在GUI的日志区域会显示所有操作细节
```

### 重新安装依赖
```bash
pip install --upgrade xhs python-dotenv playwright
playwright install chromium
```

---

## ✅ 验证修复

运行以下命令验证修复是否成功:

```bash
# 1. 测试Cookie
python test_cookie_loading.py

# 预期输出:
# OK User info retrieved
#    Nickname: 你的昵称

# 2. 启动工具
start_publish_fixed.bat

# 预期: GUI正常打开，无错误提示
```

---

## 🎉 开始使用

1. **首次使用**: 运行 `fix_cookie_quick.bat` 登录
2. **日常使用**: 运行 `start_publish_fixed.bat` 发布
3. **Cookie过期**: 重新运行 `fix_cookie_quick.bat`

**就这么简单！**

---

**修复时间**: 2026-01-29  
**版本**: V3.0 Fixed  
**状态**: ✅ 可用
