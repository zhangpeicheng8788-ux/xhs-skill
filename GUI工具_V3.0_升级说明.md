# 小红书批量发布 GUI V3.0 - 升级说明

## 🎉 V3.0 核心功能

### 1. 发布记录系统 ✅

**功能**：
- 自动记录所有已发布的笔记
- 持久化存储到 `publish_records.json`
- 支持查看完整发布历史

**记录内容**：
```json
{
  "note_hash": {
    "note_dir": "D:\\jieyue_work\\note_1",
    "note_name": "note_1",
    "title": "笔记标题",
    "note_id_xhs": "6978527100000000220308dc",
    "link": "https://www.xiaohongshu.com/explore/...",
    "published_at": "2026-01-29T15:30:00",
    "hash": "abc123..."
  }
}
```

### 2. 智能去重功能 ✅

**原理**：
- 基于笔记路径和内容生成唯一哈希值
- 发布前自动检查是否已发布
- 已发布的笔记自动跳过

**优点**：
- 避免重复发布
- 节省时间和资源
- 保护账号安全

### 3. 发布标记文件 ✅

**功能**：
- 在笔记目录创建 `.published` 标记文件
- 双重保障，即使记录文件丢失也能识别

**标记文件内容**：
```json
{
  "note_dir": "...",
  "title": "...",
  "note_id_xhs": "...",
  "link": "...",
  "published_at": "...",
  "hash": "..."
}
```

### 4. 发布统计 ✅

**显示信息**：
- 总发布数量
- 今日发布数量
- 实时更新

**界面显示**：
```
📊 发布统计: 总计 25 篇 | 今日 5 篇
```

### 5. 发布记录查看器 ✅

**功能**：
- 点击"发布记录"按钮查看
- 按时间倒序显示
- 显示标题、时间、链接等信息

---

## 🆕 V3.0 vs V2.0 对比

| 功能 | V2.0 | V3.0 |
|------|------|------|
| **发布记录系统** | ❌ | ✅ 完整记录 |
| **智能去重** | ❌ | ✅ 自动跳过已发布 |
| **发布标记** | ❌ | ✅ .published 文件 |
| **发布统计** | ❌ | ✅ 总计+今日 |
| **发布历史** | ❌ | ✅ 可查看 |
| **递归检测** | ✅ | ✅ 保留 |
| **路径选择** | ✅ | ✅ 保留 |
| **批量发布** | ✅ | ✅ 保留 |

---

## 🎯 使用流程

### 第 1 步：启动 GUI

```bash
start_publish.bat
```

### 第 2 步：查看统计信息

界面顶部显示：
```
📊 发布统计: 总计 0 篇 | 今日 0 篇
```

### 第 3 步：选择资源路径

输入或浏览选择包含笔记的文件夹

### 第 4 步：检测笔记

点击"检测笔记"按钮，系统会：
- 递归扫描所有子文件夹
- 检查每个笔记是否已发布
- 显示统计信息

**检测结果示例**：
```
笔记数量: 10 个 (已发布: 5, 未发布: 5)
✨ 发现 5 个新笔记待发布
```

### 第 5 步：开始发布

点击"开始发布"按钮：
- 自动跳过已发布的笔记
- 只发布新笔记
- 发布成功后自动记录

### 第 6 步：查看发布记录

点击"发布记录"按钮查看所有已发布的笔记

---

## 📋 发布记录系统详解

### 记录文件位置

```
D:\20260127XHS\Auto-Redbook-Skills-main\publish_records.json
```

### 记录结构

```json
{
  "hash_1": {
    "note_dir": "D:\\jieyue_work\\note_1",
    "note_name": "note_1",
    "title": "3280元拿驾照！德安驾校春节特惠来了",
    "note_id_xhs": "6978527100000000220308dc",
    "link": "https://www.xiaohongshu.com/explore/6978527100000000220308dc",
    "published_at": "2026-01-29T15:30:00",
    "hash": "abc123def456..."
  },
  "hash_2": {
    ...
  }
}
```

### 哈希计算方式

```python
# 基于笔记绝对路径 + cover.png 修改时间
hash_str = note_dir + "_" + cover_mtime
note_hash = md5(hash_str).hexdigest()
```

**优点**：
- 唯一标识每个笔记
- 即使笔记移动位置也能识别
- 笔记内容更新后会重新发布

---

## 🔍 智能去重逻辑

### 检测阶段

```
1. 扫描所有笔记
2. 计算每个笔记的哈希值
3. 检查哈希值是否在记录中
4. 分类为"已发布"和"未发布"
5. 显示统计信息
```

### 发布阶段

```
1. 只处理"未发布"的笔记
2. 发布成功后：
   - 添加到 publish_records.json
   - 创建 .published 标记文件
   - 更新统计信息
3. 下次运行时自动跳过
```

---

## 📊 使用场景

### 场景 1：首次发布

```
资源目录/
├── note_1/  ← 新笔记
├── note_2/  ← 新笔记
└── note_3/  ← 新笔记

检测结果：
- 总笔记: 3 个
- 已发布: 0 个
- 未发布: 3 个

发布结果：
- 发布 3 篇
- 记录到系统
```

### 场景 2：增量发布

```
资源目录/
├── note_1/  ← 已发布
├── note_2/  ← 已发布
├── note_3/  ← 已发布
├── note_4/  ← 新笔记
└── note_5/  ← 新笔记

检测结果：
- 总笔记: 5 个
- 已发布: 3 个
- 未发布: 2 个

发布结果：
- 跳过 3 篇（已发布）
- 发布 2 篇（新笔记）
```

### 场景 3：全部已发布

```
资源目录/
├── note_1/  ← 已发布
├── note_2/  ← 已发布
└── note_3/  ← 已发布

检测结果：
- 总笔记: 3 个
- 已发布: 3 个
- 未发布: 0 个

发布结果：
- 提示：所有笔记都已发布
- 不执行发布操作
```

---

## 🛠️ 发布标记文件

### 位置

```
笔记目录/.published
```

### 作用

1. **双重保障**：即使 `publish_records.json` 丢失，也能通过标记文件识别
2. **快速识别**：直接查看笔记目录就知道是否已发布
3. **备份记录**：包含完整的发布信息

### 示例

```
D:\jieyue_work\note_1\
├── cover.png
├── card_1.png
├── card_2.png
└── .published  ← 发布标记文件
```

---

## 📈 发布统计功能

### 统计信息

- **总计**：所有已发布的笔记数量
- **今日**：今天发布的笔记数量

### 更新时机

- 启动 GUI 时
- 检测笔记后
- 发布成功后
- 查看发布记录后

### 界面显示

```
┌─────────────────────────────────────────┐
│ 📊 发布统计: 总计 25 篇 | 今日 5 篇    │
└─────────────────────────────────────────┘
```

---

## 🔧 常见问题

### Q1：如何重新发布已发布的笔记？

**方法 1**：删除发布记录
```bash
# 删除全局记录
del D:\20260127XHS\Auto-Redbook-Skills-main\publish_records.json

# 删除笔记标记
del D:\jieyue_work\note_1\.published
```

**方法 2**：修改笔记内容
- 更新 cover.png 文件
- 系统会重新计算哈希值
- 识别为新笔记

### Q2：发布记录文件丢失怎么办？

**不用担心**：
- 每个笔记目录都有 `.published` 标记文件
- 系统会检查标记文件
- 不会重复发布

### Q3：如何查看某个笔记的发布信息？

**方法 1**：查看标记文件
```bash
type D:\jieyue_work\note_1\.published
```

**方法 2**：在 GUI 中查看发布记录
- 点击"发布记录"按钮
- 搜索笔记名称

### Q4：统计信息不准确怎么办？

**解决**：
- 重启 GUI
- 系统会重新加载记录
- 统计信息自动更新

---

## 💡 使用建议

### 1. 定期备份发布记录

```bash
# 备份记录文件
copy publish_records.json publish_records_backup.json
```

### 2. 保留标记文件

- 不要删除笔记目录中的 `.published` 文件
- 它是去重的重要依据

### 3. 查看发布历史

- 定期查看发布记录
- 了解发布情况
- 规划后续内容

### 4. 增量发布

- 新笔记放到同一目录
- 系统自动识别新笔记
- 只发布未发布的内容

---

## 🎉 V3.0 优势

### 1. 更智能

- 自动识别已发布笔记
- 避免重复发布
- 节省时间

### 2. 更安全

- 双重标记（记录文件 + 标记文件）
- 防止意外重复发布
- 保护账号安全

### 3. 更方便

- 一键查看发布历史
- 实时统计信息
- 清晰的日志输出

### 4. 更可靠

- 持久化存储
- 数据不丢失
- 支持断点续传

---

## 📝 升级步骤

### 从 V2.0 升级到 V3.0

1. **备份数据**（可选）
   ```bash
   # 备份旧版本
   copy scripts\publish_gui_v2.py scripts\publish_gui_v2_backup.py
   ```

2. **使用新版本**
   ```bash
   # 直接运行
   start_publish.bat
   ```

3. **首次运行**
   - 系统会创建 `publish_records.json`
   - 检测笔记时会标记已发布的笔记
   - 后续运行自动去重

---

## 🚀 立即使用

### 启动 V3.0

```bash
start_publish.bat
```

### 体验新功能

1. 查看统计信息
2. 检测笔记（自动去重）
3. 发布新笔记
4. 查看发布记录

---

**升级完成时间**：2026-01-29  
**版本**：V3.0  
**状态**：✅ 已完成，可以使用

**核心特性**：
- ✅ 发布记录系统
- ✅ 智能去重
- ✅ 发布标记
- ✅ 发布统计
- ✅ 发布历史查看
